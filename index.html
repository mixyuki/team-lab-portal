<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>チームLAB | Project Portal</title>
  <meta name="description" content="p5.jsグループワーク向けの提出・質問・テンプレ・仕様書・締切・告知ポータル" />
  <style>
    :root{
      --bg:#0e0d0b; --bg2:#14110c;
      --panel:#1f1a12; --panel-hi:#2a2418;
      --text:#f3e7d0; --muted:#b79e7a; --accent:#f1d18a;
      --shadow:rgba(0,0,0,.45);
      --gearA1:#f3d590; --gearA2:#a37a3a;
      --gearB1:#eaca88; --gearB2:#b6843f;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--text);
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN",Meiryo,sans-serif;
      background: radial-gradient(1400px 900px at 12% 0%, #1a1712 0%, var(--bg2) 60%, #0a0907 100%);
      overflow-x:hidden;
    }

    /* ===== Header with many gears ===== */
    header{ position:relative; padding:90px 20px 28px; }
    .brand{
      display:inline-block; padding:14px 22px;
      font-weight:800; font-size:26px; letter-spacing:.12em; text-transform:uppercase;
      color:var(--text);
      border:1px solid rgba(202,160,90,.6);
      background:linear-gradient(180deg, rgba(54,46,32,.85), rgba(30,26,18,.85));
      border-radius:12px;
      box-shadow:0 10px 30px var(--shadow), inset 0 1px 0 rgba(255,255,255,.06), inset 0 -1px 0 rgba(0,0,0,.4);
      position:relative; z-index:2;
    }
    .tagline{ margin-top:8px; color:var(--muted); font-size:13px; position:relative; z-index:2; }

    .gearfield{ position:absolute; inset:-20px 0 0 0; pointer-events:none; z-index:1; overflow:hidden; }
    .gear{ position:absolute; opacity:.28; filter:drop-shadow(0 8px 14px rgba(0,0,0,.55)); }
    .gear.small{ width:90px; height:90px; opacity:.35; }
    .gear.mid{ width:150px; height:150px; }
    .gear.big{ width:220px; height:220px; opacity:.22; }
    .spin-slow{ animation:spin 40s linear infinite; }
    .spin-med{  animation:spin 24s linear infinite; }
    .spin-fast{ animation:spin 12s linear infinite; }
    .reverse{ animation-direction:reverse; }
    @keyframes spin{ to{ transform:rotate(360deg); } }

    /* ===== faint big gears in body ===== */
    .bggears{ position:fixed; inset:auto -200px -120px -200px; top:40%; z-index:0; pointer-events:none; opacity:.18; }
    .bggears .g{ position:absolute; }
    .bggears .g svg{ filter:drop-shadow(0 6px 12px rgba(0,0,0,.5)); }

    /* ===== Layout ===== */
    .layout{ max-width:1200px; margin:0 auto; padding:10px 20px 60px; display:grid; gap:22px;
      grid-template-columns: 1fr 360px; align-items:start; position:relative; z-index:2; }
    @media (max-width: 980px){
      .layout{ grid-template-columns: 1fr; }
      aside{ position:static; top:auto; }
    }

    .grid{ display:grid; gap:18px; grid-template-columns:repeat(auto-fit, minmax(240px,1fr)); }
    a.card, .card{
      position:relative; display:block; text-decoration:none; color:var(--text);
      background:linear-gradient(180deg, var(--panel-hi), var(--panel));
      border:1px solid rgba(202,160,90,.35);
      border-radius:16px; padding:18px;
      box-shadow:0 10px 24px var(--shadow), inset 0 1px 0 rgba(255,255,255,.04);
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
    }
    .card:hover{ transform:translateY(-2px); box-shadow:0 18px 36px var(--shadow); border-color:rgba(202,160,90,.6); }
    .card .icon{ width:40px; height:40px; margin-bottom:10px; opacity:.95; }
    .card h3{ margin:6px 0 8px; font-size:18px; }
    .card p{ margin:0; color:var(--muted); font-size:13px; line-height:1.6; }

    aside{ position:sticky; top:16px; align-self:start; }
    .widget{
      background:linear-gradient(180deg, #2a2418, #1f1a12);
      border:1px solid rgba(202,160,90,.45);
      border-radius:16px; padding:16px; margin-bottom:16px;
      box-shadow:0 14px 26px var(--shadow), inset 0 1px 0 rgba(255,255,255,.04);
      position:relative;
    }
    .widget h3{ margin:0 0 10px; font-size:16px; display:flex; align-items:center; gap:8px; }
    .widget .small{ color:var(--muted); font-size:12px; }
    .widget .tools{ display:flex; gap:8px; flex-wrap:wrap; margin:6px 0 10px; }
    .btn{ appearance:none; border:1px solid rgba(202,160,90,.6); background:linear-gradient(#3a301f,#2a2317); color:var(--text); border-radius:10px; padding:6px 10px; cursor:pointer; font-size:12px;}
    .btn:hover{ filter:brightness(1.06); }
    .list{ display:grid; gap:8px; }
    .item{ background:#1b1710; border:1px solid rgba(202,160,90,.35); border-radius:10px; padding:10px; display:grid; gap:4px; }
    .date{ font-weight:700; color:var(--accent); font-size:13px; }
    .title{ font-size:14px; }
    .note{ color:var(--muted); font-size:12px; }

    footer{ display:none; } /* ← フッターの文言は非表示 */
    code.inline{ background:#00000033; padding:.15em .4em; border-radius:6px; border:1px solid #00000055 }

    @media (prefers-reduced-motion: reduce){
      .spin-slow,.spin-med,.spin-fast{ animation:none }
    }
  </style>
</head>
<body>
  <header>
    <div class="gearfield" id="gearfield" aria-hidden="true"></div>
    <div class="brand">チームLAB</div>
    <div class="tagline">p5.js グループワーク向け・提出＆連絡ポータル</div>
  </header>

  <!-- 背景の淡い大歯車（邪魔にならない程度） -->
  <div class="bggears" aria-hidden="true">
    <div class="g" style="left:-40px; bottom:-30px; transform:rotate(8deg);">
      <svg viewBox="-50 -50 100 100" width="280" height="280">
        <defs><linearGradient id="bgG" x1="0" x2="0" y1="0" y2="1"><stop offset="0" stop-color="var(--gearA1)"/><stop offset="1" stop-color="var(--gearA2)"/></linearGradient></defs>
        <g fill="url(#bgG)">
          <g>
            <!-- 12 teeth -->
            <rect x="-6" y="-46" width="12" height="18" rx="2" transform="rotate(0)"/>
            <rect x="-6" y="-46" width="12" height="18" rx="2" transform="rotate(30)"/>
            <rect x="-6" y="-46" width="12" height="18" rx="2" transform="rotate(60)"/>
            <rect x="-6" y="-46" width="12" height="18" rx="2" transform="rotate(90)"/>
            <rect x="-6" y="-46" width="12" height="18" rx="2" transform="rotate(120)"/>
            <rect x="-6" y="-46" width="12" height="18" rx="2" transform="rotate(150)"/>
            <rect x="-6" y="-46" width="12" height="18" rx="2" transform="rotate(180)"/>
            <rect x="-6" y="-46" width="12" height="18" rx="2" transform="rotate(210)"/>
            <rect x="-6" y="-46" width="12" height="18" rx="2" transform="rotate(240)"/>
            <rect x="-6" y="-46" width="12" height="18" rx="2" transform="rotate(270)"/>
            <rect x="-6" y="-46" width="12" height="18" rx="2" transform="rotate(300)"/>
            <rect x="-6" y="-46" width="12" height="18" rx="2" transform="rotate(330)"/>
          </g>
          <circle r="38"/><circle r="24" fill="#7d5d2a"/><circle r="9" fill="#0e0c09"/>
        </g>
      </svg>
    </div>
    <div class="g" style="right:-60px; bottom:-70px;">
      <svg viewBox="-50 -50 100 100" width="220" height="220">
        <defs><linearGradient id="bgG2" x1="0" x2="0" y1="0" y2="1"><stop offset="0" stop-color="var(--gearB1)"/><stop offset="1" stop-color="var(--gearB2)"/></linearGradient></defs>
        <g fill="url(#bgG2)">
          <g>
            <!-- 12 teeth -->
            <rect x="-5" y="-42" width="10" height="16" rx="2" transform="rotate(0)"/>
            <rect x="-5" y="-42" width="10" height="16" rx="2" transform="rotate(30)"/>
            <rect x="-5" y="-42" width="10" height="16" rx="2" transform="rotate(60)"/>
            <rect x="-5" y="-42" width="10" height="16" rx="2" transform="rotate(90)"/>
            <rect x="-5" y="-42" width="10" height="16" rx="2" transform="rotate(120)"/>
            <rect x="-5" y="-42" width="10" height="16" rx="2" transform="rotate(150)"/>
            <rect x="-5" y="-42" width="10" height="16" rx="2" transform="rotate(180)"/>
            <rect x="-5" y="-42" width="10" height="16" rx="2" transform="rotate(210)"/>
            <rect x="-5" y="-42" width="10" height="16" rx="2" transform="rotate(240)"/>
            <rect x="-5" y="-42" width="10" height="16" rx="2" transform="rotate(270)"/>
            <rect x="-5" y="-42" width="10" height="16" rx="2" transform="rotate(300)"/>
            <rect x="-5" y="-42" width="10" height="16" rx="2" transform="rotate(330)"/>
          </g>
          <circle r="32"/><circle r="18" fill="#6a4f24"/><circle r="7" fill="#0e0c09"/>
        </g>
      </svg>
    </div>
  </div>

  <div class="layout">
    <section>
      <div class="grid">
        <a class="card" href="https://github.com/mixyuki/team-lab-portal/upload/main/" target="_blank" rel="noopener">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 2a1 1 0 0 1 1 1v8h3l-4 4-4-4h3V3a1 1 0 0 1 1-1Zm-7 14h14v2H5v-2Zm0 4h14v2H5v-2Z"/></svg>
          <h3>コード提出所（直接アップロード）</h3>
          <p>ドラッグ＆ドロップでファイルを追加。ブランチは <code class="inline">main</code> にアップロードされます。</p>
        </a>

        <a class="card" href="https://github.com/mixyuki/team-lab-portal/issues/new?template=question.yml&labels=question&title=%5B%E8%B3%AA%E5%95%8F%5D%20" target="_blank" rel="noopener">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 2C7.58 2 4 5.13 4 9c0 2.12 1.21 4 3.08 5.22-.09.64-.39 1.85-1.35 3.08 0 0 2.02.05 3.5-1.02.87.24 1.79.37 2.77.37 4.42 0 8-3.13 8-7s-3.58-7-8-7Zm-1 14h2v2h-2v-2Zm1-10a3 3 0 0 1 3 3c0 1.66-1 2.5-2 3s-1 1-1 2h-2c0-1.66 1-2.5 2-3s1-1 1-2a1 1 0 1 0-2 0H9a3 3 0 0 1 3-3Z"/></svg>
          <h3>質問所</h3>
          <p>Issueフォームで投稿。タイトルは <code class="inline">[質問]</code> が最初から入ります。</p>
        </a>

        <a class="card" href="https://docs.google.com/document/d/15iWvrL86NOksH4maCYUsMtmDxA-mzQuFaKK7sVM1A_U/edit?tab=t.0" target="_blank" rel="noopener">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M6 2h9l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2Zm8 1v5h5"/></svg>
          <h3>提出書類ひな形置き場</h3>
          <p>Googleドキュメントの公式ひな形。リポジトリ版は <code class="inline">/templates</code>。</p>
        </a>

        <a class="card" href="https://docs.google.com/presentation/d/1fWPjOryjAAWAW_Dpzgfq15F4uCYXzzfu7d25auBewPc/edit?usp=sharing" target="_blank" rel="noopener">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M4 4h16v16H4V4Zm2 2v12h12V6H6Zm3 3h6v2H9V9Zm0 4h6v2H9v-2Z"/></svg>
          <h3>内田さん専用スライド</h3>
          <p>仕様確認や共有メモに使える個別スライド。提出作業と併せてチェック。</p>
        </a>

        <a class="card" href="https://docs.google.com/presentation/d/1_zlUtozRwqlBZOe75tpm1K6kZa2xj6we9o1xxARpk0w/edit?usp=sharing" target="_blank" rel="noopener">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M4 4h16v16H4V4Zm2 2v12h12V6H6Zm3 3h6v2H9V9Zm0 4h6v2H9v-2Z"/></svg>
          <h3>福本さん専用スライド</h3>
          <p>仕様確認や共有メモに使える個別スライド。提出や連絡の参考に活用。</p>
        </a>

        <a class="card" href="https://github.com/mixyuki/team-lab-portal/blob/main/docs/spec.md" target="_blank" rel="noopener">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M4 6h16v2H4V6Zm0 4h16v10H4V10Zm2 2v6h12v-6H6Z"/></svg>
          <h3>ゲーム仕様書</h3>
          <p>ステージ・操作・UI・役割・締切をここで管理。</p>
        </a>

        <a class="card" href="https://github.com/mixyuki/team-lab-portal/projects" target="_blank" rel="noopener">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M3 4h18v2H3V4Zm0 4h8v12H3V8Zm10 0h8v12h-8V8Z"/></svg>
          <h3>進捗ボード</h3>
          <p>GitHub Projects（Todo / Doing / Done）。</p>
        </a>
      </div>
    </section>

    <aside>
      <div class="widget" id="calWidget">
        <h3>締切カレンダー</h3>
        <div class="tools"><button class="btn" onclick="downloadICS()">ICSをダウンロード</button></div>
        <div class="small" id="calInfo">リポジトリ直下の <code class="inline">deadlines.json</code> を読み込みます。</div>
        <div id="calList" class="list" aria-live="polite" style="margin-top:8px"></div>
      </div>

      <div class="widget" id="noticeWidget">
        <h3>告知</h3>
        <div class="small" id="noticeInfo">重要なお知らせを掲載。</div>
        <div id="noticeList" class="list" style="margin-top:8px"></div>
      </div>
    </aside>
  </div>

  <footer></footer>

  <script>
    /* ====== Many Gears in Header ====== */
    const field = document.getElementById('gearfield');
    const gears = [
      {x:-30,  y:-40, size:'big',  speed:'slow'},
      {x:140,  y:-20, size:'mid',  speed:'med',  reverse:true},
      {x:320,  y:-60, size:'big',  speed:'slow', reverse:true, opacity:.2},
      {x:520,  y:-10, size:'mid',  speed:'med'},
      {x:720,  y:-30, size:'big',  speed:'slow'},
      {x:910,  y:  0, size:'mid',  speed:'med',  reverse:true},
      {x:60,   y: 70, size:'small',speed:'fast'},
      {x:260,  y: 80, size:'small',speed:'fast', reverse:true},
      {x:460,  y: 70, size:'small',speed:'fast'},
      {x:660,  y: 80, size:'small',speed:'fast', reverse:true},
      {x:860,  y: 60, size:'small',speed:'fast'},
      {x:1060, y: 70, size:'small',speed:'fast', reverse:true}
    ];
    const gearSVG = (type)=> {
      if(type==='big') return `
        <svg viewBox="-50 -50 100 100" width="220" height="220" aria-hidden="true">
          <defs><linearGradient id="gA" x1="0" x2="0" y1="0" y2="1"><stop offset="0" stop-color="var(--gearA1)"/><stop offset="1" stop-color="var(--gearA2)"/></linearGradient></defs>
          <g fill="url(#gA)">${teeth(12,46,12,18,6)}<circle r="38"/><circle r="24" fill="#7d5d2a"/><circle r="9" fill="#0e0c09"/></g>
        </svg>`;
      if(type==='mid') return `
        <svg viewBox="-50 -50 100 100" width="150" height="150" aria-hidden="true">
          <defs><linearGradient id="gB" x1="0" x2="0" y1="0" y2="1"><stop offset="0" stop-color="var(--gearB1)"/><stop offset="1" stop-color="var(--gearB2)"/></linearGradient></defs>
          <g fill="url(#gB)">${teeth(12,42,10,16,5)}<circle r="32"/><circle r="18" fill="#6a4f24"/><circle r="7" fill="#0e0c09"/></g>
        </svg>`;
      return `
        <svg viewBox="-50 -50 100 100" width="90" height="90" aria-hidden="true">
          <g fill="var(--gearA1)">${teeth(12,36,8,14,4)}<circle r="26"/><circle r="14" fill="#6a4f24"/><circle r="6" fill="#0e0c09"/></g>
        </svg>`;
    };
    function teeth(count, rY, w, h, rx){
      const step = 360 / count; let s = '';
      for(let i=0;i<count;i++){ s += `<rect x="${-w/2}" y="${-rY}" width="${w}" height="${h}" rx="${rx}" transform="rotate(${i*step})"/>`; }
      return s;
    }
    function addGear(g){
      const d = document.createElement('div');
      d.className = `gear ${g.size} spin-${g.speed}` + (g.reverse?' reverse':'');
      d.style.left = g.x+'px'; d.style.top = g.y+'px';
      if(g.opacity) d.style.opacity = g.opacity;
      d.innerHTML = gearSVG(g.size);
      field.appendChild(d);
    }
    gears.forEach(addGear);

    /* ====== Calendar & Notices ====== */
    const calList = document.getElementById('calList');
    const calInfo = document.getElementById('calInfo');
    let calendarEvents = [];

    async function loadDeadlines(){
      calList.innerHTML = '<div class="item"><div>読み込み中…</div></div>';
      try{
        const res = await fetch('./deadlines.json', { cache:'no-store' });
        if(!res.ok) throw new Error('not ok');
        const data = await res.json();
        calendarEvents = (data||[]).filter(e=>e.date).map((e,i)=>({ id:e.id||('ev-'+i), title:e.title||'Untitled', date:e.date, time:e.time||null, note:e.note||'' }));
        calInfo.textContent = 'deadlines.json から読み込みました。';
      }catch(err){
        calendarEvents = [
          {"id":"proto","title":"プロトタイプ提出","date":"2025-11-01","time":"17:00","note":"チームごとにPR"},
          {"id":"qa","title":"テスト＆QA","date":"2025-11-15","time":"23:59","note":"バグ報告締切"},
          {"id":"final","title":"最終発表","date":"2025-12-05","time":"10:00","note":"A教室"}
        ];
        calInfo.innerHTML = 'deadlines.json が見つからないため <strong>サンプル</strong> を表示しています。';
      }
      calendarEvents.sort((a,b)=> new Date(a.date + 'T' + (a.time||'00:00')) - new Date(b.date + 'T' + (b.time||'00:00')));
      calList.innerHTML = calendarEvents.map(e=>{
        const d = new Date(e.date + 'T' + (e.time||'00:00'));
        const mm = String(d.getMonth()+1).padStart(2,'0');
        const dd = String(d.getDate()).padStart(2,'0');
        const w = ['日','月','火','水','木','金','土'][d.getDay()];
        const label = `${d.getFullYear()}/${mm}/${dd}(${w})` + (e.time? ` ${e.time}`:'');
        return `<div class="item"><div class="date">${label}</div><div class="title">${escapeHtml(e.title)}</div><div class="note">${escapeHtml(e.note)}</div></div>`;
      }).join('');
    }

    function escapeHtml(s){ return (s||'').replace(/[&<>\"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\\":"&#92;","\"":"&quot;","'":"&#39;"}[c])); }
    function toICSDate(dateStr,timeStr){ if(!timeStr) return dateStr.replace(/-/g,''); const [y,m,d]=dateStr.split('-'); const [hh,mm]=timeStr.split(':'); return `${y}${m}${d}T${hh}${mm}00`; }
    function downloadICS(){
      const lines = ['BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//Team LAB//Deadlines//JP'];
      (calendarEvents||[]).filter(e=>e.date).forEach(e=>{
        const uid=(e.id||e.title||'ev')+'@team-lab'; const dt=toICSDate(e.date,e.time);
        lines.push('BEGIN:VEVENT', e.time?`DTSTART:${dt}`:`DTSTART;VALUE=DATE:${dt}`, `SUMMARY:${(e.title||'Deadline').replace(/\n/g,' ')}`, e.note?`DESCRIPTION:${e.note.replace(/\n/g,' ')}`:'', `UID:${uid}`, 'END:VEVENT');
      });
      lines.push('END:VCALENDAR');
      const blob=new Blob([lines.join('\r\n')],{type:'text/calendar'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='deadlines.ics'; a.click(); URL.revokeObjectURL(a.href);
    }

    const noticeList = document.getElementById('noticeList');
    const noticeInfo = document.getElementById('noticeInfo');
    async function loadNotices(){
      noticeList.innerHTML = '<div class="item"><div>読み込み中…</div></div>';
      try{
        const res = await fetch('./announcements.json', { cache:'no-store' });
        if(!res.ok) throw new Error('not ok');
        const data = await res.json();
        renderNotices(Array.isArray(data)? data : []);
        noticeInfo.textContent = 'announcements.json から読み込みました。';
      }catch(err){
        const fallback = [
          {"date":"2025-10-25","title":"ミーティング","body":"次回定例は 10/25 19:00-（A教室／オンライン併用）。","tag":"Schedule"},
          {"date":"2025-10-20","title":"素材提出のお願い","body":"画像はPNGで背景透過、サイズは512px四方に揃えてください。","tag":"Info"}
        ];
        renderNotices(fallback);
        noticeInfo.innerHTML = 'announcements.json が見つからないため <strong>サンプル</strong> を表示しています。';
      }
    }
    function renderNotices(list){
      list.sort((a,b)=> new Date(b.date) - new Date(a.date));
      noticeList.innerHTML = list.map(n=>{
        const d = new Date(n.date); const mm=String(d.getMonth()+1).padStart(2,'0'); const dd=String(d.getDate()).padStart(2,'0'); const date=`${d.getFullYear()}/${mm}/${dd}`;
        const tag = n.tag? `<span style="display:inline-block;font-size:10px;padding:2px 6px;border-radius:999px;background:linear-gradient(#e2c276,#c4984e);color:#231a0e;margin-right:6px;">${escapeHtml(n.tag)}</span>`:'';
        return `<div class="item"><div class="date">${date}</div><div class="title">${tag}${escapeHtml(n.title||'')}</div><div class="note">${escapeHtml(n.body||'')}</div></div>`;
      }).join('');
    }

    document.addEventListener('DOMContentLoaded', ()=>{ loadDeadlines(); loadNotices(); });
  </script>
</body>
</html>
